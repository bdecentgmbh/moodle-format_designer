{"version":3,"sources":["../src/designer_section.js"],"names":["define","$","Fragment","Templates","Loadingicon","Ajax","SELECTOR","ACTIVITYLI","SECTIONLI","ACTIVITYACTION","SECTIONACTIONMENU","Y","use","courseformatselector","M","course","format","get_section_selector","DesignerSection","courseId","contextId","self","delegate","SectionController","sectionLayoutaction","bind","RestrictInfo","moduleHandler","sectionRestricted","sectionRestrictHandler","fullDescription","fullmodcontentHandler","trimDescription","trimmodcontentHandler","on","editModuleRenderer","goToURL","redirectToModule","expandSection","prototype","moduleBlock","loadingElement","moduleDescription","addSectionSpinner","sectioninfo","sectionelement","addClass","actionarea","find","get","spinner","util","add_spinner","Node","show","event","nodeName","target","iscircle","closest","classList","contains","isDescription","isPadlock","document","body","card","modurl","getAttribute","window","location","href","sectionID","hash","id","substring","section","getElementById","title","querySelector","remove","setAttribute","content","add","scrollIntoView","removeSectionSpinner","delay","element","setTimeout","removeClass","hide","getModuleId","Moodle","core_course","cm","getId","refreshSectionInfo","currentTarget","sectionId","attr","sectionReturn","args","courseid","sectionid","sectionreturn","promises","call","methodname","when","apply","done","dataencoded","data","parseJSON","modules","i","replaceActivityhtml","type","keyCode","actionItem","moduleElement","action","moduleId","preventDefault","click","THIS","fullContent","trimcontent","hasClass","sectionRestrictInfo","prev","restrictBlock","parents","length","iconBlock","layout","layouttext","text","html","val","parent","each","dataid","options","name","value","ULClasses","forEach","className","startsWith","cards","list","default","circles","addIconToContainerRemoveOnCompletion","activityHTML","replaceWith","initActionMenu","elementid","coursebase","invoke_function","core","actionmenu","newDOMNode","one","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implemented designer format js.\n *\n * @module     format_designer/designer_section\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n define(['jquery', 'core/fragment', 'core/templates', 'core/loadingicon', 'core/ajax'],\n function($, Fragment, Templates, Loadingicon, Ajax) {\n\n    var SELECTOR = {\n        ACTIVITYLI: 'li.activity',\n        SECTIONLI: 'li.section',\n        ACTIVITYACTION: 'a.cm-edit-action',\n        SECTIONACTIONMENU: '.section_action_menu.designer-menu',\n    };\n\n    Y.use('moodle-course-coursebase', function() {\n        var courseformatselector = M.course.format.get_section_selector();\n        if (courseformatselector) {\n            SELECTOR.SECTIONLI = courseformatselector;\n        }\n    });\n\n\n    /**\n     * Control designer format action\n     * @param {int} courseId\n     * @param {int} contextId\n     */\n    let DesignerSection = function(courseId, contextId) {\n        var self = this;\n        self.courseId = courseId;\n        self.contextId = contextId;\n\n        $('body').delegate(self.SectionController, 'click', self.sectionLayoutaction.bind(this));\n        $(\"body\").delegate(self.RestrictInfo, \"click\", self.moduleHandler.bind(this));\n        $(\"body\").delegate(self.sectionRestricted, \"click\", this.sectionRestrictHandler.bind(this));\n        $('body').delegate(self.fullDescription, \"click\", self.fullmodcontentHandler.bind(this));\n        $('body').delegate(self.trimDescription, \"click\", self.trimmodcontentHandler.bind(this));\n        $('body').on('click keypress', SELECTOR.ACTIVITYLI + ' ' +\n        SELECTOR.ACTIVITYACTION + '[data-action]', this.editModuleRenderer.bind(this));\n        $('body').delegate(self.goToURL, \"click\", self.redirectToModule.bind(this));\n\n        this.expandSection();\n    };\n\n    /**\n     * Selector section controller.\n     */\n    DesignerSection.prototype.goToURL = '.designer [data-action=\"go-to-url\"]';\n\n    DesignerSection.prototype.SectionController = \".designer #section-designer-action .dropdown-menu a\";\n\n    DesignerSection.prototype.RestrictInfo = \".designer .designer-section-content .call-action-block\";\n\n    DesignerSection.prototype.moduleBlock = \".designer .designer-section-content li.activity\";\n\n    DesignerSection.prototype.loadingElement = \".icon-loader-block\";\n\n    DesignerSection.prototype.sectionRestricted = \".designer .availability-section-block .section-restricted-action\";\n\n    DesignerSection.prototype.moduleDescription = \".designer .designer-section-content li .mod-description-action\";\n\n    DesignerSection.prototype.fullDescription = \".designer-section-content li .fullcontent-summary .mod-description-action\";\n\n    DesignerSection.prototype.trimDescription = \".designer-section-content li .trim-summary .mod-description-action\";\n\n    DesignerSection.prototype.addSectionSpinner = function(sectioninfo) {\n        var sectionelement = $(sectioninfo).addClass('editinprogress');\n        var actionarea = sectionelement.find('li.section').get(0);\n        if (actionarea) {\n            var spinner = M.util.add_spinner(Y, Y.Node(actionarea));\n            spinner.show();\n            return spinner;\n        }\n        return null;\n    };\n\n    DesignerSection.prototype.redirectToModule = function(event) {\n        let nodeName = event.target.nodeName;\n        let preventionNodes = ['a', 'button', 'form'];\n        let iscircle = event.target.closest('li.activity').classList.contains('circle-layout');\n        let isDescription = event.target.classList.contains('mod-description-action');\n        let isPadlock = event.target.classList.contains('fa-lock');\n        if ((nodeName in preventionNodes)\n            || document.body.classList.contains('editing') || iscircle || isDescription || isPadlock) {\n            return null;\n        }\n        var card = event.target.closest(\"[data-action=go-to-url]\");\n        let modurl = card.getAttribute('data-url');\n        window.location.href = modurl;\n    };\n\n    DesignerSection.prototype.expandSection = () => {\n        // Alert();\n        var sectionID = window.location.hash;\n        if (sectionID) {\n            var id = sectionID.substring(1);\n            var section = document.getElementById(id);\n            if (section) {\n                var title = section.querySelector('.section-header-content');\n                if (title) {\n                    title.classList.remove('collapsed');\n                    title.setAttribute('aria-expanded', true);\n                }\n                var content = section.querySelector('.content');\n                if (content) {\n                    content.classList.add('show');\n                }\n                if (document.getElementById('section-course-accordion') !== null) {\n                    document.getElementById('section-head-0').classList.add('collapsed');\n                    document.getElementById('section-content-0').classList.remove('show');\n                }\n                section.scrollIntoView();\n            }\n        }\n    };\n\n    DesignerSection.prototype.removeSectionSpinner = function(sectioninfo, spinner, delay) {\n        var element = $(sectioninfo);\n        window.setTimeout(function() {\n            element.removeClass('editinprogress');\n            if (spinner) {\n                spinner.hide();\n            }\n        }, delay);\n    };\n\n    /**\n     * Wrapper for Y.Moodle.core_course.util.cm.getId\n     *\n     * @param {JQuery} element\n     * @returns {Integer}\n     */\n     DesignerSection.prototype.getModuleId = function(element) {\n        var id;\n        Y.use('moodle-course-util', function(Y) {\n            id = Y.Moodle.core_course.util.cm.getId(Y.Node(element.get(0)));\n        });\n        return id;\n    };\n\n    DesignerSection.prototype.refreshSectionInfo = function(target) {\n        var self = this;\n        let sectioninfo = target.currentTarget.closest(\"li.section\");\n        let sectionId = $(sectioninfo).attr('data-id');\n        let sectionReturn = $(sectioninfo).attr('data-sectionreturnid');\n        var spinner = self.addSectionSpinner(sectioninfo);\n        var args = {\n            courseid: self.courseId,\n            sectionid: sectionId,\n            sectionreturn: sectionReturn\n        };\n        window.setTimeout(function(args) {\n            var promises = Ajax.call([{\n                methodname: 'format_designer_section_refresh',\n                args: args\n            }], true);\n            $.when.apply($, promises)\n                .done(function(dataencoded) {\n                    var data = $.parseJSON(dataencoded);\n                    if (data.modules !== undefined) {\n                        for (var i in data.modules) {\n                            self.replaceActivityhtml(data.modules[i]);\n                        }\n                    }\n                });\n\n        }, 1000, args);\n        self.removeSectionSpinner(sectioninfo, spinner, 400);\n    };\n\n    DesignerSection.prototype.editModuleRenderer = function(event) {\n        var self = this;\n        if (event.type === 'keypress' && event.keyCode !== 13) {\n            return;\n        }\n        var actionItem = $(event.currentTarget),\n        moduleElement = actionItem.closest(SELECTOR.ACTIVITYLI),\n        action = actionItem.attr('data-action'),\n        moduleId = self.getModuleId(moduleElement);\n        switch (action) {\n            case 'moveleft':\n            case 'moveright':\n            case 'delete':\n            case 'duplicate':\n            case 'hide':\n            case 'stealth':\n            case 'show':\n            case 'groupsseparate':\n            case 'groupsvisible':\n            case 'groupsnone':\n                break;\n            default:\n                // Nothing to do here!\n                return;\n        }\n        if (!moduleId) {\n            return;\n        }\n        event.preventDefault();\n        if (action === 'delete') {\n            // Deleting requires confirmation.\n            window.setTimeout(function() {\n                $('.modal-footer button[data-action=\"save\"]').click(function() {\n                    self.refreshSectionInfo(event);\n                });\n            }, 500);\n        } else {\n            self.refreshSectionInfo(event);\n        }\n    };\n\n    DesignerSection.prototype.fullmodcontentHandler = function(event) {\n        var THIS = $(event.currentTarget);\n        let fullContent = $(THIS).closest('li.activity').find('.fullcontent-summary');\n        let trimcontent = $(THIS).closest('li.activity').find('.trim-summary');\n        if (trimcontent.hasClass('summary-hide')) {\n            trimcontent.removeClass('summary-hide');\n            fullContent.addClass('summary-hide');\n        }\n    };\n\n    DesignerSection.prototype.trimmodcontentHandler = function(event) {\n        var THIS = $(event.currentTarget);\n        let fullContent = $(THIS).closest('li.activity').find('.fullcontent-summary');\n        let trimcontent = $(THIS).closest('li.activity').find('.trim-summary');\n        if (fullContent.hasClass('summary-hide')) {\n            fullContent.removeClass('summary-hide');\n            trimcontent.addClass('summary-hide');\n        }\n    };\n\n    DesignerSection.prototype.sectionRestrictHandler = function(event) {\n        var sectionRestrictInfo = $(event.currentTarget).prev();\n        if (sectionRestrictInfo) {\n            if (!sectionRestrictInfo.hasClass('show')) {\n                sectionRestrictInfo.addClass('show');\n            } else {\n                sectionRestrictInfo.removeClass('show');\n            }\n        }\n    };\n\n    DesignerSection.prototype.moduleHandler = function(event) {\n        event.preventDefault();\n        var restrictBlock = $(event.currentTarget).parents('.restrict-block');\n        if (restrictBlock.length) {\n            if (!restrictBlock.hasClass('show')) {\n                restrictBlock.addClass('show');\n            } else {\n                restrictBlock.removeClass('show');\n            }\n        }\n    };\n\n    /**\n     * Implementaion swith the section layout.\n     * @param {object} event\n     */\n    DesignerSection.prototype.sectionLayoutaction = function(event) {\n        var self = this;\n        let sectionId = event.target.closest('li.section').getAttribute('id');\n        var iconBlock = \"#\" + sectionId + \" \" + self.loadingElement;\n        var layout = $(event.currentTarget).data('value');\n        var layouttext = $(event.currentTarget).text();\n        $(event.target).parents(\".dropdown\").find(\".btn\").html(layouttext);\n        $(event.target).parents(\".dropdown\").find(\".btn\").val(layout);\n        $(event.target).parent().find(\"a.dropdown-item\").each(function() {\n            $(this).removeClass('active');\n        });\n        $(event.target).addClass('active');\n        let dataid = event.target.closest('li.section').getAttribute('data-id');\n        var args = {\n            courseid: self.courseId,\n            sectionid: dataid,\n            options: [{name: $(event.currentTarget).data('option'), value: layout}]\n        };\n        var ULClasses = {\n            'cards': 'card-deck card-layout',\n            'list': 'list-layout',\n            'default': 'link-layout',\n            'circles': 'circles-layout'\n        };\n        var promises = Ajax.call([{\n                methodname: 'format_designer_set_section_options',\n                args: args\n            }], true);\n        $.when.apply($, promises)\n            .done(function(dataencoded) {\n                var data = $.parseJSON(dataencoded);\n                if (data.modules !== undefined) {\n                    for (var i in data.modules) {\n                        self.replaceActivityhtml(data.modules[i]);\n                    }\n                    document.getElementById(sectionId).classList.forEach((className) => {\n                        if (className.startsWith('section-type-')) {\n                            document.getElementById(sectionId).classList.remove(className);\n                        }\n                    });\n                    document.getElementById(sectionId).classList.add('section-type-' + layout);\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.cards);\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.list);\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.default);\n                    $('#' + sectionId).find('ul.section').removeClass(ULClasses.circles);\n                    $('#' + sectionId).find('ul.section').addClass(ULClasses[layout]);\n                }\n            });\n        Loadingicon.addIconToContainerRemoveOnCompletion(iconBlock, promises);\n    };\n\n    /**\n     * Replaces the course module with the new html (used to update module after it was edited or its visibility was changed).\n     *\n     * @param {String} activityHTML\n     */\n    DesignerSection.prototype.replaceActivityhtml = function(activityHTML) {\n        $('<div>' + activityHTML + '</div>').find(SELECTOR.ACTIVITYLI).each(function() {\n            // Extract id from the new activity html.\n            var id = $(this).attr('id');\n            // Find the existing element with the same id and replace its contents with new html.\n            $(SELECTOR.ACTIVITYLI + '#' + id).replaceWith(activityHTML);\n            // Initialise action menu.\n            initActionMenu(id);\n        });\n    };\n\n    /**\n     * Initialise action menu for the element (section or module)\n     *\n     * @param {String} elementid CSS id attribute of the element\n     */\n    var initActionMenu = function(elementid) {\n        // Initialise action menu in the new activity.\n        Y.use('moodle-course-coursebase', function() {\n            M.course.coursebase.invoke_function('setup_for_resource', '#' + elementid);\n        });\n        if (M.core.actionmenu && M.core.actionmenu.newDOMNode) {\n            M.core.actionmenu.newDOMNode(Y.one('#' + elementid));\n        }\n    };\n\n    return {\n        init: function(courseId, contextId) {\n            return new DesignerSection(courseId, contextId);\n        }\n    };\n});"],"file":"designer_section.min.js"}