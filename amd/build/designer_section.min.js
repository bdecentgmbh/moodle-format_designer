define ("format_designer/designer_section",["jquery","core/fragment","core/templates","core/loadingicon","core/ajax"],function(a,b,c,d,e){var f={ACTIVITYLI:"li.activity",SECTIONLI:"li.section",ACTIVITYACTION:"a.cm-edit-action",SECTIONACTIONMENU:".section_action_menu.designer-menu"};Y.use("moodle-course-coursebase",function(){var a=M.course.format.get_section_selector();if(a){f.SECTIONLI=a}});var g=function(b,c){var d=this;d.courseId=b;d.contextId=c;a("body").delegate(d.SectionController,"click",d.sectionLayoutaction.bind(this));a("body").delegate(d.RestrictInfo,"click",d.moduleHandler.bind(this));a("body").delegate(d.sectionRestricted,"click",this.sectionRestrictHandler.bind(this));a("body").delegate(d.fullDescription,"click",d.fullmodcontentHandler.bind(this));a("body").delegate(d.trimDescription,"click",d.trimmodcontentHandler.bind(this));a("body").on("click keypress",f.ACTIVITYLI+" "+f.ACTIVITYACTION+"[data-action]",this.editModuleRenderer.bind(this))};g.prototype.SectionController=".designer #section-designer-action .dropdown-menu a";g.prototype.RestrictInfo=".designer #designer-section-content .call-action-block";g.prototype.moduleBlock=".designer #designer-section-content li.activity";g.prototype.loadingElement=".icon-loader-block";g.prototype.sectionRestricted=".designer .availability-section-block .section-restricted-action";g.prototype.moduleDescription=".designer #designer-section-content li .mod-description-action";g.prototype.fullDescription="#designer-section-content li .fullcontent-summary .mod-description-action";g.prototype.trimDescription="#designer-section-content li .trim-summary .mod-description-action";g.prototype.addSectionSpinner=function(b){var c=a(b).addClass("editinprogress"),d=c.find("li.section").get(0);if(d){var e=M.util.add_spinner(Y,Y.Node(d));e.show();return e}return null};g.prototype.removeSectionSpinner=function(b,c,d){var e=a(b);window.setTimeout(function(){e.removeClass("editinprogress");if(c){c.hide()}},d)};g.prototype.getModuleId=function(a){var b;Y.use("moodle-course-util",function(c){b=c.Moodle.core_course.util.cm.getId(c.Node(a.get(0)))});return b};g.prototype.refreshSectionInfo=function(b){var c=this,d=b.currentTarget.closest("li.section"),f=a(d).attr("data-id"),g=a(d).attr("data-sectionreturnid"),h=c.addSectionSpinner(d),i={courseid:c.courseId,sectionid:f,sectionreturn:g};window.setTimeout(function(b){var d=e.call([{methodname:"format_designer_section_refresh",args:b}],!0);a.when.apply(a,d).done(function(b){var d=a.parseJSON(b);if(d.modules!==void 0){for(var e in d.modules){c.replaceActivityhtml(d.modules[e])}}})},1e3,i);c.removeSectionSpinner(d,h,400)};g.prototype.editModuleRenderer=function(b){var c=this;if("keypress"===b.type&&13!==b.keyCode){return}var d=a(b.currentTarget),e=d.closest(f.ACTIVITYLI),g=d.attr("data-action"),h=c.getModuleId(e);switch(g){case"moveleft":case"moveright":case"delete":case"duplicate":case"hide":case"stealth":case"show":case"groupsseparate":case"groupsvisible":case"groupsnone":break;default:return;}if(!h){return}b.preventDefault();if("delete"===g){window.setTimeout(function(){a(".modal-footer button[data-action=\"save\"]").click(function(){c.refreshSectionInfo(b)})},500)}else{c.refreshSectionInfo(b)}};g.prototype.fullmodcontentHandler=function(b){var c=a(b.currentTarget),d=a(c).closest("li.activity").find(".fullcontent-summary"),e=a(c).closest("li.activity").find(".trim-summary");if(e.hasClass("summary-hide")){e.removeClass("summary-hide");d.addClass("summary-hide")}};g.prototype.trimmodcontentHandler=function(b){var c=a(b.currentTarget),d=a(c).closest("li.activity").find(".fullcontent-summary"),e=a(c).closest("li.activity").find(".trim-summary");if(d.hasClass("summary-hide")){d.removeClass("summary-hide");e.addClass("summary-hide")}};g.prototype.sectionRestrictHandler=function(b){var c=a(b.currentTarget).prev();if(c){if(!c.hasClass("show")){c.addClass("show")}else{c.removeClass("show")}}};g.prototype.moduleHandler=function(b){b.preventDefault();var c=a(b.currentTarget).parents(".restrict-block");if(c.length){if(!c.hasClass("show")){c.addClass("show")}else{c.removeClass("show")}}};g.prototype.sectionLayoutaction=function(b){var c=this,f=b.target.closest("li.section").getAttribute("id"),g="#"+f+" "+c.loadingElement,h=a(b.currentTarget).data("value"),i=a(b.currentTarget).text();a(b.target).parents(".dropdown").find(".btn").html(i);a(b.target).parents(".dropdown").find(".btn").val(h);a(b.target).parent().find("a.dropdown-item").each(function(){a(this).removeClass("active")});a(b.target).addClass("active");var j=b.target.closest("li.section").getAttribute("data-id"),k={courseid:c.courseId,sectionid:j,options:[{name:a(b.currentTarget).data("option"),value:h}]},l={cards:"card-deck card-layout",list:"list-layout",default:"link-layout",circles:"circles-layout"},m=e.call([{methodname:"format_designer_set_section_options",args:k}],!0);a.when.apply(a,m).done(function(b){var d=a.parseJSON(b);if(d.modules!==void 0){for(var e in d.modules){c.replaceActivityhtml(d.modules[e])}document.getElementById(f).classList.forEach(function(a){if(a.startsWith("section-type-")){document.getElementById(f).classList.remove(a)}});document.getElementById(f).classList.add("section-type-"+h);a("#"+f).find("ul.section").removeClass(l.cards);a("#"+f).find("ul.section").removeClass(l.list);a("#"+f).find("ul.section").removeClass(l.default);a("#"+f).find("ul.section").removeClass(l.circles);a("#"+f).find("ul.section").addClass(l[h])}});d.addIconToContainerRemoveOnCompletion(g,m)};g.prototype.replaceActivityhtml=function(b){a("<div>"+b+"</div>").find(f.ACTIVITYLI).each(function(){var c=a(this).attr("id");a(f.ACTIVITYLI+"#"+c).replaceWith(b);h(c)})};var h=function(a){Y.use("moodle-course-coursebase",function(){M.course.coursebase.invoke_function("setup_for_resource","#"+a)});if(M.core.actionmenu&&M.core.actionmenu.newDOMNode){M.core.actionmenu.newDOMNode(Y.one("#"+a))}};return{init:function init(a,b){return new g(a,b)}}});
//# sourceMappingURL=designer_section.min.js.map
