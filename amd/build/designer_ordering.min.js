define("format_designer/designer_ordering",["jquery","core_course/actions","core/ajax"],(function($,action,ajax){var CSS_EDITINPROGRESS="editinprogress",CSS_EDITINGMOVE="editing_move",SELECTOR_ACTIVITYLI="li.activity",SELECTOR_ACTIONAREA=".actions",SELECTOR_SECTIONLI="li.section";function removeSpinner(element,spinner,delay){window.setTimeout((function(){element.removeClass(CSS_EDITINPROGRESS),spinner&&spinner.hide()}),delay)}return{init:function(){Y.use("moodle-course-coursebase",(function(){M.course.coursebase.register_module({set_visibility_resource_ui:function(args){var element,id,mainelement=$(args.element.getDOMNode()),cmid=(element=mainelement,Y.use("moodle-course-util",(function(Y){id=Y.Moodle.core_course.util.cm.getId(Y.Node(element.get(0)))})),id);if(cmid){mainelement.css("opacity",0);var sectionreturn=mainelement.find("."+CSS_EDITINGMOVE).attr("data-sectionreturn"),sectionId=mainelement.closest(SELECTOR_SECTIONLI).attr("data-id"),spinner=function(activity){activity.addClass(CSS_EDITINPROGRESS);var actionarea=activity.find(SELECTOR_ACTIONAREA).get(0);if(actionarea){var spinner=M.util.add_spinner(Y,Y.Node(actionarea));return spinner.show(),spinner}return null}(mainelement),promises=ajax.call([{methodname:"format_designer_get_module",args:{id:cmid,sectionid:sectionId,sectionreturn:sectionreturn}}],!0);$.when.apply($,promises).done((function(data){var activityHTML;removeSpinner(mainelement,spinner,400),activityHTML=data,setTimeout((function(){$("<div>"+activityHTML+"</div>").find(SELECTOR_ACTIVITYLI).each((function(){var elementid,id=$(this).attr("id");$(SELECTOR_ACTIVITYLI+"#"+id).replaceWith(activityHTML),elementid=id,Y.use("moodle-course-coursebase",(function(){M.course.coursebase.invoke_function("setup_for_resource","#"+elementid)})),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(Y.one("#"+elementid)),$(SELECTOR_ACTIVITYLI+"#"+id).css("opacity",1)}))}),1e3)})).fail((function(){removeSpinner(mainelement,spinner)}))}}})}))}}}));

//# sourceMappingURL=designer_ordering.min.js.map