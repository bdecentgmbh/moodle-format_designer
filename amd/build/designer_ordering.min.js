define(["jquery","format_designer/actions","core/ajax"],function(a,b,c){function d(){Y.use("moodle-course-coursebase",function(){M.course.coursebase.register_module({set_visibility_resource_ui:function(b){var d=a(b.element.getDOMNode()),h=f(d);if(h){d.css("opacity",0);var l=d.find("."+j.EDITINGMOVE).attr("data-sectionreturn"),m=d.closest(k.SECTIONLI).attr("data-id"),n=i(d),o=c.call([{methodname:"format_designer_get_module",args:{id:h,sectionid:m,sectionreturn:l}}],!0);a.when.apply(a,o).done(function(a){g(d,n,400),e(a)}).fail(function(){g(d,n)})}}})})}function e(b){setTimeout(function(){a("<div>"+b+"</div>").find(k.ACTIVITYLI).each(function(){var c=a(this).attr("id");a(k.ACTIVITYLI+"#"+c).replaceWith(b),h(c),a(k.ACTIVITYLI+"#"+c).css("opacity",1)})},1e3)}function f(a){var b;return Y.use("moodle-course-util",function(c){b=c.Moodle.core_course.util.cm.getId(c.Node(a.get(0)))}),b}function g(a,b,c){window.setTimeout(function(){a.removeClass(j.EDITINPROGRESS),b&&b.hide()},c)}function h(a){Y.use("moodle-course-coursebase",function(){M.course.coursebase.invoke_function("setup_for_resource","#"+a)}),M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(Y.one("#"+a))}function i(a){a.addClass(j.EDITINPROGRESS);var b=a.find(k.ACTIONAREA).get(0);if(b){var c=M.util.add_spinner(Y,Y.Node(b));return c.show(),c}return null}var j={EDITINPROGRESS:"editinprogress",EDITINGMOVE:"editing_move"},k={ACTIVITYLI:"li.activity",ACTIONAREA:".actions",SECTIONLI:"li.section"};return{init:function(){d()}}});